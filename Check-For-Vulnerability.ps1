#=============================================================================# 
#                                                                             # 
# Check-For-Vulnerability.ps1                                   	            # 
# Powershell Script to search for a service and 			                        #
# depending on whether installed search for a hotfix.                         # 
# Author: James Kowalczik                                                     # 
# Creation Date: 04.23.2015                                                   # 
# Version: 1.0.0                                                              # 
#                                                                             # 
#=============================================================================# 

Param(
   [String]$UpdateToSearchFor = "KB3042553",
   [String]$ServiceToSearchFor = "W3SVC",
   [String]$Hostname = "localhost",
   [String]$CSVFile = ""
)

############## Functions ################
Function Is-Service-Installed(){
   If((Get-Service $ServiceToSearchFor -Computername $Hostname -ErrorAction SilentlyContinue)){ Return $true }
   Return $false
}

Function Is-Update-Installed(){
   If((Get-Hotfix $UpdateToSearchFor -Computername $Hostname -ErrorAction SilentlyContinue)){ Return $true }
   Return $false
}

Function CheckIt(){
   If(Is-Service-Installed){
      If(-Not (Is-Update-Installed)){
         Write-Output "Update $UpdateToSearchFor is not installed on $Hostname.  Please Install."
      }Else{
         Write-Output "$Hostname is patched appropriately for $UpdateToSearchFor"
      }
   }
}
########### End Of Functions #############

If($CSVFile -eq ""){
   ### Run this if no CSV File is used.  This will check 1 device #####
   CheckIt
}Else{
   ### Run this is a CSV File is used.  This will check
   ### all devices in the column with a header of 'Servers'.
   Import-CSV $CSVFile | ForEach-Object {
      $Hostname = $_.Servers
      CheckIt
   }
}
